{:title "IntroducingÂ Facelets",
 :date "2007-11-19",
 :layout :post,
 :tags ["webdev" "java" "library"],
 :tags-orig ["framework" "java" "javaEE" "jsf" "UI" "webapp"],
 :categories ["j2ee" "Languages"],
 :extra-css #{}
}

++++
<p>You might have already heard about <a title="Facelets - home" href="https://facelets.dev.java.net/">Facelets</a> (<a title="Facelets - user guide (though called developer doc.)" href="https://facelets.dev.java.net/docs/dev/docbook.html">docs</a>), a library for Java Server Faces (JSF), and wondered why it is popular and what it is good for. I've wondered too and now I want to share the answers with you.</p><p>Warning: I'm a novice to Facelets and some things may be not completely exact.&nbsp;</p><p>Facelets is</p><ul><li>an alternative, non-JSP view technology and handler for JSF that gives you the power of JSP while avoiding its inherent problems with JSF</li><li>a simple templating system similar partly to Tiles</li><li>a way to use newer JSF (1.2) in an older servlet container (below JSP 2.1) that couldn't support it otherwise</li><li>it's compatible with JSF 1.2 and can be used with Sun's RI or with Apache's MyFaces<br /></li></ul><h2>&nbsp;Facelets is an alternative, non-JSP view handler</h2><p>It's very difficult and error-prone to use JSP to define JSF views because they've different life-cycles and just don't fit together well. Result: you must enclose most non-jsf content by f:verbatim and you may be sometimes surprised by content appearing in a different order in the resulting html. See <a href="https://www.onjava.com/pub/a/onjava/2004/06/09/jsf.html" title="On Java Article">Improving JSF by Dumping JSP</a> by Hans Bergsten.</p><p>Facelets were designed as a view technology for JSF and let you define your views in XHTML and mix freely JSF components, xhtml, <a href="https://en.wikipedia.org/wiki/Unified_Expression_Language" title="Wikipedia: about JSP 2.1's unified EL">unified expression language</a> (including custom functions), and a subset of JSTL (core, functions; for example c:if). All of these are translated into a jsf component tree and go through the same life-cycle. No more problems with mixing jsf components and jsf-unaware html: everything is a part of a component with Facelets.</p><p>You can defined your views in .xhtml, or, if you want to keep your IDE's support including autocompletion, you can <a title="Tip: use JSP with xml syntax with Facelets to keep IDE's autocompletion etc." href="https://www.mojavelinux.com/blog/archives/2006/12/facelets_tag_completion_in_eclipse/">use JSPX with Facelets</a> (JSPX = JSP with xml syntax; Facelets require its view definition to be a valid xml).</p><p>Example - mypage.jspx: </p><pre><code>&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;jsp:root xmlns:jsp="http://java.sun.com/JSP/Page"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:f="http://java.sun.com/jsf/core"
  version="2.0"&gt;
   &lt;html xmlns="http://www.w3.org/1999/xhtml"&gt;
      &lt;head&gt;&lt;title&gt;JSPX Facelets example&lt;/title&gt;&lt;/head&gt;</code>
<code></code>      &lt;body&gt;
<code>         &lt;ui:composition&gt;</code>
<code>         </code><code></code><code>   &lt;h:messages id="messages1" styleClass="messages"&gt;
</code><code>         </code><code>   </code><code>#{myManagedBean.sayHello}</code>
<code>         &lt;/ui:composition&gt;</code>
<code>      </code><code></code><code>&lt;/body&gt;
</code><code>   </code><code></code><code>&lt;/html&gt;
&lt;/jsp:root&gt;</code></pre><h2>Facelets as a templating system</h2><p>The framework provides a couple of tags that let you create and apply page templates: in a template you specify variable, page-dependant content (perhaps with some default content) using <font face="courier new,courier,monospace">ui:insert name=&quot;...&quot;</font>, in a page (a template client) you enclose the code that shouldn't be ignored by <font face="courier new,courier,monospace">ui:composition template=&quot;&lt;template file path&gt;&quot;</font>&nbsp; and finally use some <font face="courier new,courier,monospace">ui:define name=&quot;...&quot;</font> to define content for the template's ui:inserts. This let you easily define e.g. common layout in for your pages.</p><p>The description is a very brief and simplified one, refer to the <a href="https://facelets.dev.java.net/nonav/docs/dev/docbook.html#template">Facelets templating</a> docs to learn about its full power.<br /></p><h2>And even more...</h2><h3>&nbsp;Easy creation of composite components</h3><p>Another distinct advantage of Facelets is that it let you create extremely easily components composed from other components: you just define the composition as another xhtml fragment, define the tag to use for it in a Facelets tag library. An example from the Facelets docs:</p><p>Tag description from a Facelets taglib file mytags.taglib.xml (referenced by the context parameter facelets.LIBRARIES):</p><pre class="programlisting">&lt;?xml version=&quot;1.0&quot;?&gt;<br />&lt;!DOCTYPE facelet-taglib PUBLIC &quot;-//Sun Microsystems, Inc.//DTD Facelet Taglib 1.0//EN&quot; &quot;facelet-taglib_1_0.dtd&quot;&gt;<br />&lt;facelet-taglib&gt;<br />  &lt;namespace&gt;http://example.com/my&lt;/namespace&gt;<br /><a id="taglib-create-source">  &lt;tag&gt;<br />    &lt;tag-name&gt;echo&lt;/tag-name&gt;<br />    &lt;source&gt;tags/echo.xhtml&lt;/source&gt;<br />  &lt;/tag&gt;</a><br />&lt;facelet-taglib&gt;</pre><p>And the tag definition - tags/echo.xhtml:&nbsp;</p><pre class="programlisting"><a id="taglib-create-source">&lt;ui:composition xmlns:ui=&quot;http://java.sun.com/jsf/facelets&quot;&gt;<br />  &lt;span class=&quot;message&quot;&gt;#{msg}&lt;/span&gt;<br />&lt;/ui:composition&gt;</a></pre><p>&nbsp;Called as (notice how the varaible msg is passed; the namespace 'my' is defined by: xmlns:my=&quot;http://example.com/my&quot;):</p><pre class="programlisting"><a id="taglib-create-source">&lt;my:echo msg=&quot;#{bean.warningMessage}&quot;/&gt;</a></pre><h3>Debugging/devel support&nbsp;</h3><p>By setting the context param <font face="courier new,courier,monospace">facelets.DEVELOPMENT</font> to <font face="courier new,courier,monospace">true</font> you instruct Facelets to display a pretty useful information whenever a processing error occures, inlcuding the exact location of the error in the xhtml/jspx. The developers have indeed taken care of providing useful output here!</p><p>When using Sun's RI, you may also want to set the context params com.sun.faces.validateXml and com.sun.faces.verifyObjects to true.</p><h3>Deploying Facelets application to JBoss 4.0.4</h3><p>Notice: I've tried Facelets 1.0.10, but the latest version is 1.1.14 - you may prefer to try that one.&nbsp;</p><p>You need the following libraries in your WEB-INF/lib (versions may differ): jsf-facelets-1.0.10.jar, el-ri-1.0.jar, el-api-1.0.jar, jstl-1.1.2.jar (all included in the Facelets <a title="Downloaded Facelets 1.0.10" href="https://facelets.dev.java.net/files/documents/3448/27389/facelets-1.0.10.zip">download</a>). </p><p>You must not have there either Sun's RI of JSF 1.2 (jsf-api, jsf-impl) or MyFaces libs (myfaces-api-1.1.2-SNAPSHOT.jar, myfaces-impl-1.1.2-SNAPSHOT.jar). The RI requires Java 1.5 that may not be possible to use for political reasons and myfaces conflict with myfaces libraries bundled with JBoss in &lt;jboss&gt;\server\default\deploy\jbossweb-tomcat55.sar\jsf-libs.</p><p>Note: If Tomcat&nbsp; cannot find the myfaces TLDs and complains about unmapped namespace http://java.sun.com/jsf/html or core, extract the TLDs from the myfaces jars and put them somewhere under your WEB-INF.<br /></p><p>That's all - assuming you've set your web.xml and faces-config.xml correctly. In web.xml you don't need anything special outside of normal JSF configuration (Faces servlet and startup listener) unless using extension mapping instead of the prefix /faces/* - in that case you must also specify .xhtml (or .jspx) as the default suffix of JSF pages using the context param. javax.faces.DEFAULT_SUFFIX. In faces-config.xml you need to set Facelets as the view handler (you may define for which resources it should be used, delegationg all others to the default jsp view handler, via its context param. facelets.VIEW_MAPPINGS): </p><pre><code>&lt;application&gt;
   &lt;view-handler&gt;com.sun.facelets.FaceletViewHandler&lt;/view-handler&gt;
&lt;/application&gt;</code></pre><p>&nbsp;That's all folks, thank you for attention!<br /></p>
++++
