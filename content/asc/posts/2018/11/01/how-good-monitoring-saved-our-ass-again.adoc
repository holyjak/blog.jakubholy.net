{:title "How good monitoring saved our ass ... again",
 :date "2018-11-01",
 :layout :post,
 :tags ["monitoring"],
 :tags-orig ["monitoring"],
 :categories ["[Dev]Ops"],
 :extra-css #{}
}

++++
You know how it goes - suddenly people complain your app does not work, your are getting plenty of timeouts or other errors in your error tracking tool, you find the backend app that is misbehaving and finally "fix" the problem by restarting it. Phew!<br><br>But why? What caused the downtime? A glitch an an upstream system? Sudden overload due to a spike in concurrent users? Trolls?<br><br>You know that it helps sometimes to zoom out, to get the right perspective. Here the perspective was 7 days:<br><br><img title="System load over the past 7 days" src="https://lh3.googleusercontent.com/iD8MlIDGGPM26RoMopxITnfTCG_OcF3-5tyD9tyImQnihoYe6e83BUMTX76lL2HD3BmJDYx-3rETnrAva0bAHh48efpoaDd3VOOOWiKGzqqvkQQFGSz5o9xnT843sqXjkXsJHxgEP1udYeQ14NgFsABJaC_3p7SvWT33qvSzmqP0TMo_XXrush-FtjrGNsqQ0CbC107ja0NpCCHpdHcNuYVl6VYrIjc6e8Ib1LVrzI_MJ9fIuZ0boJ0-IkRsyxazA_5g4LwhGfi4ulVbyaFK-GP61mrzUtuBGhbs9f0Wmr-ACKyS6Ue0xNnE55yujlF1oPEhDoCm76Oi2qskpwMrREEnURBAmTq1dy8yfn4MdjTUrbUMqVUZkoL78o7qhADK2_UOAFBwUHAbS_2zQuqEtlSBwFA_57xc0X6sDLcm4SHoK7OZYoPix0UecMC1dEKwelsKGK5IEzmmpcRe5grPBYms0QOaH7rTlpKqLC0L549HGik8jXJti6l1J8VHuUVz_oMQwIdsz8mQBMNmAXK7G6vmLZV3yTiIbYTU-w0MAQlKPsD-BKQ-MX_JYsx7t3lO5BH5uav2fPF_biyzveZcjkilkMnsIc8JyeO6X6r-jEzlC6e8vW1mxozj2CVwzN5jnn0VLC2nZgcZRoBbk8GeGnZx=w524-h221-no" /><br><br>It was enough to look at this chart with the right zoom to see at once that something happened on October 23rd that caused a significant change in the behavior of the application. Quick search and indeed, the change in CPU usage corresponds with a deployment. A quick revert to the previous version shortly confirmed the culprit. (It would have been even easier if we showed deployments on these charts.)<br><br>This is not the first time good monitoring saved us. A while ago we struggled regularly with the application becoming sluggish and had to restart it regularly. A graph of the Node.js even loop lag showed it increasing over time. Once it was on the same dashboard as Node's heap usage, we could at once see that it correlated with increasing memory usage - indicating a memory leak. Few hours of experimenting and heap dump analysis later the problem was fixed.<br><br><strong>So good monitoring is paramount.</strong><br><br>Of course the trick is to know what to monitor and to display all relevant metrics in such a way that you can spot important relations. I am still working on improving that...
++++
