{:title
 "[DRAFT] Maven \"change\" project extending a non-maven web project",
 :date "2009-04-10",
 :layout :post,
 :tags [],
 :tags-orig [],
 :categories ["Tools"],
 :extra-css #{}
}

++++
<p><i>Disclaimer: I'm rather new to Maven and thus my solution is likely not the best one. I welcome any improvement suggestions.&nbsp;</i> <br /></p><p>My current project here at IBA CZ extends a legacy non-maven web project and I had to devise how to organize the extension modules and other new modules depending upon them. The final goal was to create a portlet face for this servlet-only web application that is written in JSP and a strange presentation framework and then create specific portlets for specific needs.<br /></p><p>Key factors and motivations:</p><ol><li>The source WAR project is not under our control.</li><li>The source WAR project has been imported into an external maven repository but only with a minimal Maven POM without any definitions of dependencies etc.</li><li>I need to extend this WAR to work in our specific environment (Liferay portal) and to satisfy our specific requirements, which will require some but hopefully not many modifications of its source codes and other resources.<br /></li><li>I want to be able to migrate my changes easily to a new version of the source WAR.</li><li>I want to use Maven because its our preferred build tool, integrates well with our Continuous Integration (CI) server (Hudson), and - last but not least - handles dependencies so that I can execute <i>svn co http://ibacz.eu/my/project &amp;&amp; cd project &amp;&amp; mvn package</i> to build a working, deployable package.<br /></li></ol>My idea was to create only a &quot;change&quot; project, which would only include our changes to the original WAR (additions/deletions/modifications) and merge it with the original project fetched from its maven repository to create a final deployable artifact. Then I'd create other artifacts depending on this.<br /><br><br><h2>The source artifacts</h2><br><br><p>As I've said, the source application - jpivot.war - is maven agnostic but is imported into an external Maven repository (http://repository.pentaho.org/artifactory/).<br /></p><br><br><h3>Web app artifact: jpivot.war </h3>
<p>The web application that we want to customize. It doesn't include any classes directly - they're in WEB-INF/lib/jpivot.jar.</p><p>Its pom.xml: <br /></p><br><br><pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project&gt;<br />  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;<br />  &lt;groupId&gt;com.tonbeller&lt;/groupId&gt;<br />  &lt;artifactId&gt;jpivot&lt;/artifactId&gt;<br />  &lt;packaging&gt;war&lt;/packaging&gt;<br />  &lt;version&gt;1.8.0-081008&lt;/version&gt;<br />  &lt;description&gt;Auto generated POM&lt;/description&gt;<br />&lt;/project&gt;</pre><br><br><h3>Classes artifact: jpivot.jar</h3>
<p>The same jar as in&nbsp; jpivot.war/WEB-INF/lib/jpivot.jar but as a standalone maven artifact, also without any dependencies definitions. Its pom.xml:<br /></p><br><br><pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project&gt;<br />  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;<br />  &lt;groupId&gt;com.tonbeller&lt;/groupId&gt;<br />  &lt;artifactId&gt;jpivot&lt;/artifactId&gt;<br />  &lt;version&gt;1.8.0-081008&lt;/version&gt;<br />  &lt;description&gt;Auto generated POM&lt;/description&gt;<br />&lt;/project&gt;</pre><br><br><h3>Handling dependencies:  jpivot-libs-combined.jar</h3>
<p>For compilation and comfortable development of our change and other projects we will certainly need the source project's dependencies. Unfortunately they're not listed in its maven POM and it would be a tedious task to do that. Also we do not control the WAR's POM and it's likely that some of the dependencies also aren't mavenized, which gives us a nice recursive trouble.<br /></p><p>Therefore I'll go for the simplest solution and combine all libraries' classes from jpivot.war/WEB-INF/lib/*.jar excluding jpivot.jar (for it has already its own imported maven artifact) into a single &quot;uberjar&quot; jpivot-libs-combined.jar and deploy it to the company-wide thirdparty maven repository.</p><br><br><p>An Ant build.xml that merges all JARs except of jpivot.jar from the working directory together:<br /></p><br><br><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;<br />&lt;project name=&quot;jpivot-libs-combined&quot; default=&quot;combine&quot; basedir=&quot;.&quot;&gt;<br />  &lt;target name=&quot;combine&quot;&gt;<br />        &lt;zip destfile=&quot;jpivot-libs-combined.jar&quot;&gt;<br />                &lt;zipgroupfileset dir=&quot;.&quot; includes=&quot;*.jar&quot; excludes=&quot;jpivot.jar&quot;/&gt;<br />                &lt;fileset dir=&quot;.&quot; excludes=&quot;*.jar&quot;/&gt;<br />        &lt;/zip&gt;<br />  &lt;/target&gt;<br />&lt;/project&gt;</code></pre><br><br><p>A pom.xml that shall be included with the combined JAR:<br /></p><br><br><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project&gt;<br />  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;<br />  &lt;groupId&gt;com.tonbeller&lt;/groupId&gt;<br />  &lt;artifactId&gt;jpivot-libs-combined&lt;/artifactId&gt;<br />  &lt;version&gt;1.8.0-081008&lt;/version&gt;<br />  &lt;dependencies&gt;<br />    &lt;dependency&gt;<br />        &lt;!-- Dummy dependency to show what has this been generated from --&gt;<br />        &lt;groupId&gt;com.tonbeller&lt;/groupId&gt;<br />        &lt;artifactId&gt;jpivot&lt;/artifactId&gt;<br />        &lt;version&gt;1.8.0-081008&lt;/version&gt;<br />        &lt;type&gt;war&lt;/type&gt;<br />        &lt;scope&gt;provided&lt;/scope&gt;<br />        &lt;optional&gt;true&lt;/optional&gt;<br />    &lt;/dependency&gt;<br />  &lt;/dependencies&gt;<br />  &lt;description&gt;<br />  Dependencies extraced from jpivot.war/WEB-INF/lib (excluding jpivot.jar that already has a maven artefact) and merged into a single .jar.<br />  &lt;/description&gt;<br />&lt;/project&gt;</code></pre><br><br><p>Commands to create the uberjar and install it into a maven repository:</p><pre>/tmp$ unzip /path/to/jpivot.war WEB-INF/lib<br />/tmp$ ant -f /path/to/the/build.xml<br />/tmp$ mvn install:install-file -Dfile=jpivot-libs-combined.jar -DgroupId=com.tonbeller -DartifactId=jpivot-libs-combined -Dversion=1.8.0-081008 -Dpackaging=jar -DgeneratePom=true<br /><br /></pre><p>Now we should deploy the artifact to the company-wide Maven repository for thirdparty stuff and replace the pom.xml generated by the install command with the one provided above.</p><br><br><h2>Our artifacts</h2><p>Finally the artifacts that we do develop. </p><br><br><h3>A root POM</h3><p>I like a parent POM for my artifacts that defines common configuration including properties, repositories and SW versions.</p>
<pre><code>
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;&gt;
    &lt;parent&gt;
        &lt;artifactId&gt;ibacz-root-pom&lt;/artifactId&gt;
        &lt;groupId&gt;eu.ibacz.maven&lt;/groupId&gt;
        &lt;version&gt;1.1&lt;/version&gt;
    &lt;/parent&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;<br><br>    &lt;groupId&gt;eu.ibacz.pbns&lt;/groupId&gt;
    &lt;artifactId&gt;pbns-root-pom&lt;/artifactId&gt;
    &lt;packaging&gt;pom&lt;/packaging&gt;
    &lt;name&gt;PBNS - Root project&lt;/name&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;description/&gt;<br><br>    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;source&gt;1.5&lt;/source&gt;
                    &lt;target&gt;1.5&lt;/target&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-enforcer-plugin&lt;/artifactId&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;id&gt;enforce-versions&lt;/id&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;enforce&lt;/goal&gt;
                        &lt;/goals&gt;
                        &lt;configuration&gt;
                            &lt;rules&gt;
                                &lt;requireMavenVersion&gt;
                                    &lt;version&gt;2.0.9&lt;/version&gt;
                                &lt;/requireMavenVersion&gt;
                                &lt;requireJavaVersion&gt;
                                    &lt;version&gt;1.5&lt;/version&gt;
                                &lt;/requireJavaVersion&gt;
                            &lt;/rules&gt;
                        &lt;/configuration&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;<br><br>    &lt;repositories&gt;
        &lt;repository&gt;
            &lt;id&gt;pentaho&lt;/id&gt;
            &lt;name&gt;iba copy of pentaho repo at http://repository.pentaho.org/artifactory&lt;/name&gt;
            &lt;url&gt;http://w3.ibacz.cz/nexus/content/repositories/pentaho&lt;/url&gt;
            &lt;snapshots&gt;
                &lt;enabled&gt;false&lt;/enabled&gt;
            &lt;/snapshots&gt;
        &lt;/repository&gt;
        &lt;repository&gt;
            &lt;id&gt;thirdparty&lt;/id&gt;
            &lt;name&gt;Third party repository&lt;/name&gt;
            &lt;url&gt;http://w3.ibacz.cz/nexus/content/repositories/thirdparty&lt;/url&gt;
        &lt;/repository&gt;
    &lt;/repositories&gt;<br><br>    &lt;properties&gt;
        &lt;wcf.version&gt;1.8.0-070305&lt;/wcf.version&gt;
        &lt;jpivot.version&gt;1.8.0-081008&lt;/jpivot.version&gt;
        &lt;jpivot.source.version&gt;1.8.0-081008snapshotsrc&lt;/jpivot.source.version&gt;
    &lt;/properties&gt;<br><br>&lt;/project&gt;
</code></pre><br><br><h3>The &quot;change&quot; artifacts</h3><p>As mentioned, these reflect the source artifacts and contain changes to them.<br /></p><h4 align="left">jpivot-classes-customized [jar] </h4><p>Depends on jpivot.jar and contains classes changed from the original jar. They're combined together for deployment, overriding original classes with the modified ones.</p><p>The combination and overriding is done by using the maven-dependency-plugin and its undeploy goal to unpack jpivot.jar to the target compilation prior to running the compile phase, which will thus override original jpivot's classes with our modified ones.</p><br><br><pre><code>
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;&gt;
    &lt;parent&gt;
        &lt;artifactId&gt;pbns-root-pom&lt;/artifactId&gt;
        &lt;groupId&gt;eu.ibacz.pbns&lt;/groupId&gt;
        &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;groupId&gt;eu.ibacz.pbns&lt;/groupId&gt;
    &lt;artifactId&gt;jpivot-classes-customized&lt;/artifactId&gt;
    &lt;name&gt;Customized JPivot Classes&lt;/name&gt;
    &lt;version&gt;1.8.0-SNAPSHOT&lt;/version&gt;<br><br>    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.tonbeller&lt;/groupId&gt;
            &lt;artifactId&gt;jpivot&lt;/artifactId&gt;
            &lt;version&gt;${jpivot.version}&lt;/version&gt;
            &lt;type&gt;jar&lt;/type&gt;
            &lt;scope&gt;provided&lt;/scope&gt; &lt;!-- don't propagate further as it will be merged into this project's jar --&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.tonbeller&lt;/groupId&gt;
            &lt;artifactId&gt;jpivot-libs-combined&lt;/artifactId&gt;
            &lt;version&gt;${jpivot.version}&lt;/version&gt;
            &lt;scope&gt;compile&lt;/scope&gt; &lt;!-- with 'provided' it doesn't get as a transitive dep. of this project's dependants. --&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
    &lt;description&gt;modified classes of jpivot.jar&lt;/description&gt;
    &lt;build&gt;
        &lt;finalName&gt;jpivot-classes-customized&lt;/finalName&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;!--
                    Merge this project's classes with the original jpivot.jar. You can
                    safely ignore reports about duplicates - this happens for classes
                    that we override here.
                --&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-dependency-plugin&lt;/artifactId&gt;
                &lt;version&gt;2.1&lt;/version&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;id&gt;unpack&lt;/id&gt;
                        &lt;phase&gt;process-resources&lt;/phase&gt; &lt;!-- To run before compile and this be overriden by compiled classes --&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;unpack&lt;/goal&gt;
                        &lt;/goals&gt;
                        &lt;configuration&gt;
                            &lt;artifactItems&gt;
                                &lt;artifactItem&gt;
                                    &lt;groupId&gt;com.tonbeller&lt;/groupId&gt;
                                    &lt;artifactId&gt;jpivot&lt;/artifactId&gt;
                                    &lt;version&gt;${jpivot.version}&lt;/version&gt;
                                    &lt;type&gt;jar&lt;/type&gt;
                                &lt;/artifactItem&gt;
                            &lt;/artifactItems&gt;
                            &lt;!--excludes&gt;**/AClassIDontLike.class&lt;/excludes&gt; --&gt;
                            &lt;outputDirectory&gt;${project.build.outputDirectory}&lt;/outputDirectory&gt;
                        &lt;/configuration&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/project&gt;</code></pre><br><br><h4>jpivot-web-customized [war] </h4><p>Depends on and includes jpivot-classes-customized.jar and depends on jpivot.war, contains changed and new resources and is merged with jpivot.war replacing its jpivot.jar with our jpivot-classes-customized.jar during packaging.</p><p>The combination and overriding is done by using overlays of the maven-war-plugin. We also exclude jpivot.jar and replace it with our dependency  jpivot-classes-customized.jar (which mixes the original jar with our changes).</p><br><br><pre><code>&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br />    xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;&gt;<br />    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;<br />    &lt;groupId&gt;eu.ibacz.pbns&lt;/groupId&gt;<br />    &lt;artifactId&gt;jpivot-web-customized&lt;/artifactId&gt;<br />    &lt;packaging&gt;war&lt;/packaging&gt;<br />    &lt;version&gt;1.8.0-SNAPSHOT&lt;/version&gt;<br />    &lt;name&gt;jpivot-web-customized Maven Webapp&lt;/name&gt;<br />    &lt;dependencies&gt;<br />        &lt;dependency&gt;<br />            &lt;groupId&gt;junit&lt;/groupId&gt;<br />            &lt;artifactId&gt;junit&lt;/artifactId&gt;<br />            &lt;version&gt;3.8.1&lt;/version&gt;<br />            &lt;scope&gt;test&lt;/scope&gt;<br />        &lt;/dependency&gt;<br />        &lt;dependency&gt;<br />            &lt;groupId&gt;com.tonbeller&lt;/groupId&gt;<br />            &lt;artifactId&gt;jpivot&lt;/artifactId&gt;<br />            &lt;version&gt;${jpivot.version}&lt;/version&gt;<br />            &lt;type&gt;war&lt;/type&gt;<br />        &lt;/dependency&gt;<br />        &lt;dependency&gt;<br />            &lt;groupId&gt;eu.ibacz.pbns&lt;/groupId&gt;<br />            &lt;artifactId&gt;jpivot-classes-customized&lt;/artifactId&gt;<br />            &lt;version&gt;1.8.0-SNAPSHOT&lt;/version&gt;<br />        &lt;/dependency&gt;<br />    &lt;/dependencies&gt;<br />    &lt;description&gt;Our modification of the original jpivot 1.8.0 webapp. This project should only include the classes, JSPs etc. that we do change.<br />    A package is generated by combining this with the original war.&lt;/description&gt;<br />    &lt;parent&gt;<br />        &lt;artifactId&gt;pbns-root-pom&lt;/artifactId&gt;<br />        &lt;groupId&gt;eu.ibacz.pbns&lt;/groupId&gt;<br />        &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;<br />    &lt;/parent&gt;<br />    &lt;build&gt;<br />        &lt;finalName&gt;jpivot-web-customized&lt;/finalName&gt;<br />        &lt;plugins&gt;<br />            &lt;plugin&gt;<br />                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;<br />                &lt;artifactId&gt;maven-war-plugin&lt;/artifactId&gt;<br />                &lt;version&gt;2.1-alpha-2&lt;/version&gt;<br />                &lt;configuration&gt;<br />                    &lt;!--<br />                        exclude jpivot.jar, replace it with jpivot-classes-customized.jar<br />                    --&gt;<br />                    &lt;packagingExcludes&gt;**/jpivot-libs-combined-*.jar&lt;/packagingExcludes&gt;<br />                    &lt;overlays&gt;<br />                        &lt;overlay&gt;<br />                            &lt;groupId&gt;com.tonbeller&lt;/groupId&gt;<br />                            &lt;artifactId&gt;jpivot&lt;/artifactId&gt;<br />                            &lt;excludes&gt;<br />                                &lt;exclude&gt;WEB-INF/lib/jpivot.jar&lt;/exclude&gt;<br />                                &lt;!-- Mondrian stuff we do not needed. --&gt;<br />                                &lt;exclude&gt;WEB-INF/mondrian.properties&lt;/exclude&gt;<br />                                &lt;exclude&gt;WEB-INF/datasources.xml&lt;/exclude&gt;<br />                            &lt;/excludes&gt;<br />                        &lt;/overlay&gt;<br />                    &lt;/overlays&gt;<br />                &lt;/configuration&gt;<br />            &lt;/plugin&gt;<br />        &lt;/plugins&gt;<br />    &lt;/build&gt;<br />&lt;/project&gt;</code></pre><br><br><h3>New dependant artifacts</h3><br><br><h4>jpivot-portlet-liferay-classes [jar]</h4><p>Classes necessary to implement a jpivot portlet working under the Liferay portal (5.2.2).<br /></p><p>Depends on jpivot-classes-customized.jar for compilation only. It depends also on some Liferay libraries that have been imported into our thirdparty maven repository.<br /></p><br><br><pre><code>&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br />    xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;&gt;<br />    &lt;parent&gt;<br />        &lt;artifactId&gt;pbns-root-pom&lt;/artifactId&gt;<br />        &lt;groupId&gt;eu.ibacz.pbns&lt;/groupId&gt;<br />        &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;<br />    &lt;/parent&gt;<br />    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;<br />    &lt;groupId&gt;eu.ibacz.pbns&lt;/groupId&gt;<br />    &lt;artifactId&gt;jpivot-portlet-liferay-classes&lt;/artifactId&gt;<br />    &lt;name&gt;JPivot Liferay Portlet Classes&lt;/name&gt;<br />    &lt;version&gt;1.8.0-SNAPSHOT&lt;/version&gt;<br /><br />    &lt;dependencies&gt;<br />        &lt;dependency&gt;<br />            &lt;groupId&gt;eu.ibacz.pbns&lt;/groupId&gt;<br />            &lt;artifactId&gt;jpivot-classes-customized&lt;/artifactId&gt;<br />            &lt;version&gt;1.8.0-SNAPSHOT&lt;/version&gt;<br />            &lt;type&gt;jar&lt;/type&gt;<br />        &lt;/dependency&gt;<br /><br />        &lt;dependency&gt;<br />            &lt;groupId&gt;javax.servlet&lt;/groupId&gt;<br />            &lt;artifactId&gt;servlet-api&lt;/artifactId&gt;<br />            &lt;version&gt;2.3&lt;/version&gt;<br />            &lt;scope&gt;provided&lt;/scope&gt;<br />        &lt;/dependency&gt;<br /><br />        &lt;dependency&gt;<br />            &lt;groupId&gt;javax.portlet&lt;/groupId&gt;<br />            &lt;artifactId&gt;portlet-api&lt;/artifactId&gt;<br />            &lt;version&gt;2.0&lt;/version&gt;<br />            &lt;scope&gt;provided&lt;/scope&gt;<br />        &lt;/dependency&gt;<br />        &lt;dependency&gt;<br />            &lt;groupId&gt;com.liferay&lt;/groupId&gt;<br />            &lt;artifactId&gt;portal-kernel&lt;/artifactId&gt;<br />            &lt;version&gt;5.2.2&lt;/version&gt;<br />            &lt;type&gt;jar&lt;/type&gt;<br />            &lt;scope&gt;provided&lt;/scope&gt;<br />        &lt;/dependency&gt;<br />        &lt;dependency&gt;<br />            &lt;groupId&gt;com.liferay&lt;/groupId&gt;<br />            &lt;artifactId&gt;portal-service&lt;/artifactId&gt;<br />            &lt;version&gt;5.2.2&lt;/version&gt;<br />            &lt;type&gt;jar&lt;/type&gt;<br />            &lt;scope&gt;provided&lt;/scope&gt;<br />        &lt;/dependency&gt;<br />        &lt;dependency&gt;<br />            &lt;groupId&gt;com.liferay&lt;/groupId&gt;<br />            &lt;artifactId&gt;portal-impl&lt;/artifactId&gt;<br />            &lt;version&gt;5.2.2&lt;/version&gt;<br />            &lt;type&gt;jar&lt;/type&gt;<br />            &lt;scope&gt;provided&lt;/scope&gt;<br />        &lt;/dependency&gt;<br />        <br />        &lt;!--<br />            Actually included in jpivot's libs, but made explicit here; Apache<br />            FOP for printing<br />        --&gt;<br />        &lt;dependency&gt;<br />            &lt;groupId&gt;fop&lt;/groupId&gt;<br />            &lt;artifactId&gt;fop&lt;/artifactId&gt;<br />            &lt;version&gt;0.20.5&lt;/version&gt;<br />            &lt;type&gt;jar&lt;/type&gt;<br />            &lt;scope&gt;provided&lt;/scope&gt;<br />        &lt;/dependency&gt;<br />    &lt;/dependencies&gt;<br />    &lt;description&gt;Classes for a jpivot portlet ready for Liferay&lt;/description&gt;<br />    &lt;build&gt;<br />        &lt;finalName&gt;jpivot-portlet-liferay-classes&lt;/finalName&gt;<br />    &lt;/build&gt;<br />&lt;/project&gt;</code></pre><br><br><h4> bns-portlets [war]</h4><p>A set of JPivot portlets, usually consisting of JSPs, CSSs, and JSs.<br /></p><p>Extends further jpivot-web-customized and is merged with this WAR during packaging, same as jpivot-web-customized itself is merged with jpivot.war. Only it doesn't include any changes but only additions.</p><br><br><pre><code>&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br />    xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;&gt;<br />    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;<br />    &lt;groupId&gt;eu.ibacz.pbns&lt;/groupId&gt;<br />    &lt;artifactId&gt;bns-portlets&lt;/artifactId&gt;<br />    &lt;packaging&gt;war&lt;/packaging&gt;<br />    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;<br />    &lt;name&gt;BNS Portal Portlets&lt;/name&gt;<br /><br />    &lt;dependencies&gt;<br />        &lt;dependency&gt;<br />            &lt;groupId&gt;eu.ibacz.pbns&lt;/groupId&gt;<br />            &lt;artifactId&gt;jpivot-web-customized&lt;/artifactId&gt;<br />            &lt;version&gt;1.8.0-SNAPSHOT&lt;/version&gt;<br />            &lt;type&gt;war&lt;/type&gt;<br />        &lt;/dependency&gt;<br />        &lt;dependency&gt;<br />            &lt;groupId&gt;eu.ibacz.pbns&lt;/groupId&gt;<br />            &lt;artifactId&gt;jpivot-portlet-liferay-classes&lt;/artifactId&gt;<br />            &lt;version&gt;1.8.0-SNAPSHOT&lt;/version&gt;<br />            &lt;type&gt;jar&lt;/type&gt;<br />        &lt;/dependency&gt;<br />    &lt;/dependencies&gt;<br />    &lt;description&gt;<br />  Portlets for BNS Portal panels based on our modified JPivot and jpivot liferay portlet support.<br />  &lt;/description&gt;<br />    &lt;parent&gt;<br />        &lt;artifactId&gt;pbns-root-pom&lt;/artifactId&gt;<br />        &lt;groupId&gt;eu.ibacz.pbns&lt;/groupId&gt;<br />        &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;<br />    &lt;/parent&gt;<br />    &lt;build&gt;<br />        &lt;finalName&gt;bns-portlets&lt;/finalName&gt;<br />        &lt;plugins&gt;<br />            &lt;plugin&gt;<br />                &lt;!-- Merge this WAR with the jpivot war stuff. --&gt;<br />                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;<br />                &lt;artifactId&gt;maven-war-plugin&lt;/artifactId&gt;<br />                &lt;version&gt;2.1-alpha-2&lt;/version&gt;<br />                &lt;configuration&gt;<br />                    &lt;!-- Exclude the transitive jpivot libs dependency - the WAR has it. --&gt;<br />                    &lt;packagingExcludes&gt;WEB-INF/lib/jpivot-libs-combined-*.jar&lt;/packagingExcludes&gt;<br />                    &lt;overlays&gt;<br />                        &lt;overlay&gt;<br />                            &lt;groupId&gt;eu.ibacz.pbns&lt;/groupId&gt;<br />                            &lt;artifactId&gt;jpivot-web-customized&lt;/artifactId&gt;<br />                        &lt;/overlay&gt;<br />                    &lt;/overlays&gt;<br />                &lt;/configuration&gt;<br />            &lt;/plugin&gt;<br />        &lt;/plugins&gt;<br />    &lt;/build&gt;<br />&lt;/project&gt;</code></pre><br><br><h3>The build process summarized</h3><ol><li><i>jpivot-classes-customized</i> is compiled and merged with the original jpivot.jar into a single archive.</li><li><i>jpivot-web-customized</i> is merged with the original jpivot.war, replacing its WEB-INF/lib/jpivot.war with the already built jpivot-classes-customized.jar. The output is a standalone and deployable standard web application.<br /></li><li><i>jpivot-portlet-liferay-classes</i> is packaged in the standard way and the produced JAR includes only its own classes.<br /></li><li><i>bns-portlets</i> is merged with our already built jpivot-web-customized.war to produce a deployable portlet application.<br /></li></ol><h2>A development project for IDEs<br /></h2><p>The &quot;change projects&quot; are not complete on their own and are therefore not very suitable for use for development in an Integrated Development Environment (IDE). If we used an IDE to work on a change web project, it would complain about missing TLDs and other resources from the WAR to be merged in and it wouldn't be able to deploy it thus loosing the advantage of hot deploy.</p><p>The proposed solutions is as follows:</p><ol><li>Build the final, complete bns-portlets.war (<font size="2" face="courier new,courier,monospace">cd bns-portlets; mvn package</font>).</li><li>Import the WAR as a project into an IDE.</li><ul><li>Eclipse: File - Import - Web - WAR file.</li><li>NetBeans: Unpack the WAR somewhere then File - New Project - Java Web - Web Application with Existing Sources - go to the unpacked directory.<br /></li></ul><li>You should have defined a Liferay runtime environment for the server. If not, you will need to add classpath entries for the Liferay libraries it uses to be able to compile it.<br /></li><li>Delete WEB-INF/lib/jpivot-portlet-liferay-classes.jar.</li><li>// If WEB-INF/classes hasn't precedence over lib/ then delete classes that we've modified from jpivot-classes-customized.jar.<br /></li><li>Add 2 new source folders that are linked to the source folders of the jar projects, namely one to jpivot-classes-customized/src/main/java/ and the other to jpivot-portlet-liferay-classes/src/main/java/ .</li><ul><li>Eclipse: Project - Properties - Java Build Path - Source - [Link Source]<br /></li></ul><li>Develop.<br /></li><ul><li>Now you can modify the sources if needed and commit their modifications to SVN. Because we actually work on the original projects' directories, the proper svn metadata will be picked up and the changes will be commited to the respective projects.</li><ul><li>Unfortunately Eclipse ignores the SVN information of the linked sources. To be able to commit etc. them you'll need either to use another svn client or have the projects owning the sources open in Eclipse. An alternative is may be to drop the links and define project dependency.<br /></li></ul><li>If you need to modify another source code or resource file, copy it first to the approrpiate change project from the original jpivot.war or jpivot.jar's sources.</li></ul></ol>All changes will be commited to the corresponding SVN projects so this is ok but there is now the risk that a developer will do something in this development project, commit it to SVN, but forgets to build and deploy the corresponding real project's artifact. Well, this is a risk we have to live with. Such an omission could be detected by our continuous integration server (indicated by a failed build) and perhaps we could add a test which verifies that deployed artifacts aren't older than the corresponding SVN project.<br /><h2>Known limitations and issues</h2><h2>Next steps</h2><p>Continuous integration with Hudson.<br /></p><h2>Conclusion/summary</h2><p>TODO<br /></p>
++++
