{:title "Focus & Do the Simplest Thing Possible",
 :date "2015-01-09",
 :layout :post,
 :tags ["opinion"],
 :tags-orig ["opinion"],
 :categories ["SW development"],
 :extra-css #{}
}

++++
<a href="https://www.flickr.com/photos/archer10/2212600119/in/photolist-4nw9VV-dC8RjF-a1Wc78-FCfZX-bsiz8v-aAPMWG-j1phGk-gLuLzN-imrCVb-an35tY-97LbDK-pcLbnb-f1s7hT-qFrir3-jCc6hY-dCd6L4-3S78FC-7n6Sy-6Y1VGy-7zVYAy-dMFMXD-gXhJy8-ab5d1N-nWSgRn-fKVh47-bzdFzn-eJsEtY-5KYpcE-kZrPbz-9X5d6w-q4e14s-bkcYqj-pqTYE9-pQ8juv-nFvsE2-pfJ2of-nyDNG4-8rkjTZ-iJWtcx-8Nab5k-appic5-n4vNa-eJewv1-jmtXAY-iwcbYt-hJE4bi-4wqtM1-jktjU7-qiEi8q-9a5aCa"><img class="size-full wp-image-4163" title="Yak at Yundrok Yumtso Lake" src="/images/2015/01/yak-by-dennis_jarvis.jpg" alt="" width="240" height="180" /></a> Credit: Dennis Jarvis, CC<br><br>Are you tired of days spent in front of the screen, with no results to show? Have you once again engaged in <a href="https://sethgodin.typepad.com/seths_blog/2005/03/dont_shave_that.html">yak shaving</a>? Today, after having failed previously, I have finally managed to solve a problem while avoiding this trap by following rigorously two guidelines preached by grandmaster programmers. Be warned: Following this approach, you will get a working solution - but you won't like it. It will be ugly, stained by compromises, far from the elegant solution you wish for. But if your resources are limited and you want to avoid death by too many yaks, this is your only option. But first, what are these guidelines?<br><br>One: Maintain a laser-sharp <em>focus</em>. A great programmer is constantly aware of what she is trying to achieve and never strays far from it. If the path leads away, she backs up. If something else pops up, she writes it down for later and gets back to the job. This is essentially about deciding what <em>not</em> to do. (Many thanks to Kent Beck for <a href="/2012/09/12/programming-like-kent-beck/">sharing his focus secret</a>!)<br><br><!--more--><br><br>Two: Always find the <em>simplest, smallest thing</em> - a stepping stone - that moves you toward the goal. It might not be especially pretty but perfect is the enemy of good. ("Make it work, make it right, make it fast." - Kent's father, reportedly.)<br><br>In addition, there are a few more crucial ingredients. Awarness of cost/benefit so that you know when to give up because it is not worth the effort. Coming up with various alternatives so that you don't get locked to a single solution. Doing the most unclear and risky things first rather than the nice, easy ones.<br><br>Side note: This awareness of one's goal and possible alternatives at different points of the journey reminds me a lot of the <a href="https://mikadomethod.wordpress.com/2010/02/02/the-mikado-method-in-under-a-minute/">Mikado Method</a> and, inspired by it, I use <a href="https://mindmup.com/">mind maps</a> to keep a track of this.<br><br><h2>My story</h2><br><br>My goal, that I have previously failed to achieve due to too many dead ends, was to introduce tests to our front-end application. This was complicated by the use of bleeding edge technologies (=&gt; you'll bleed when using them) such as EcmaScript 6 and React/Jest, the need to stub/mock parts of the application (<a title="XMLHttpRequest" href="https://en.wikipedia.org/wiki/XMLHttpRequest">XHR</a>) that were <a title="Node.js: require()" href="https://nodejs.org/api/all.html#all_require"><code>required</code></a> by the module under test, and a build relying on Browserify and Gulp.<br><br>As my highly respected colleague and master of all things front-end Pål Ruud commented:<br><br><blockquote>Mix of Jest, Browserify and ES6 has turned out to be really difficult to make to play together. :-(<br><br>I believe I made six different attempts to get a test to run, with different combinations of test frameworks and 6to5, es6ify, traceur.</blockquote><br><br>One of my weaknesses is that I find it difficult to resist such a challenge. Especially regarding missing testing. So I begun my attempt by listing the goal, alternatives, and top risks:<br><br><a href="/images/2015/01/woop-testing-mindmup-1.jpg"><img class="size-full wp-image-4151" src="/images/2015/01/woop-testing-mindmup-1.jpg" alt="Mind map of the problem" width="521" height="421" /></a> Mind map of the problem<br><br>This lists the goal - which, fully expressed, would read "<em>Create the simplest possible test of a simple method of a <a href="https://facebook.github.io/flux/docs/overview.html">(Flux) Store</a> class,</em>" the main questions (such as whether to run the tests under Node.js or the browser), and, in red, the points of highest risk - the necessity to pre-process the ES6 files and to <a href="https://martinfowler.com/articles/mocksArentStubs.html">mock (or rather stub)</a> XHR during the tests.<br><br>The simplest &amp; smallest guideline implied that I should reuse the build workflow we already had - Gulp with browserify taking care of es6to5, reactifying etc. - and thus run tests in the browser instead on Node.js (which is considerably slower but also less constraining, enabling us to test also UI-related code in the future). Among the technologies discussed with Pål I have thus also opted for the more mature ones (primarily <a href="https://karma-runner.github.io/0.12/index.html">Karma</a> over <a href="https://github.com/airportyh/testem">Testem</a>). It also required that I stayed with the built-in <code>assert</code> rather than using something fancy like Chai (though switching over could be a future step). So here is the resulting plan:<br><br><ol>
    <li>Verify we will be able to mock XHR during tests (otherwise we'd need to either find a different solution or change the design to factor out XHR calls) &lt;- proxyquireify</li>
    <li>Create a dummy test and make Browserify include in the output .js file</li>
    <li>Get a minimal Karma+Mocha test running in a browser, not touching our production code yet</li>
    <li>Require the Store from the test and verify we can call a simple method on it</li>
    <li>Stub XHR so that we can test an actual business method though, for the sake of simplicity, we won't care about data returned by XHR</li>
</ol><br><br>This led me indeed to a solution though it is very far from what I would like to have. I had to intentionally sacrificy a lot for the sake of getting a working solution [soon]:<br><br><ul>
    <li>Ability to run tests instantly (i.e. &lt; 3s) and automatically as soon as I save a file - this requirement has nothing to do with the goal itself and is a path to yak hordes</li>
    <li>Running tests under Node instead of a browser that incurs a great overhead due to browserifying, es6to5-fying, and JSX-fying and starting a real browser</li>
    <li>Using the less invasive PhantomJS (it failed for some reason, while Chrome worked)</li>
    <li>Running tests from our watch task or as a part of our build task - for the sake of simplicity, I have created a separate task that has to be invoked separately</li>
    <li>Being able to make XHR calls return data synchronously in a test so that I could fake what back-end would return and verify the outcome (we use Promises that run asynchronously; there are workarounds but well beyond the scope of my goal - and making our stores decoupled from XHR is anyway a better solution)</li>
</ul><br><br>I am sure we will eventually find a solution for all of these. But the most important thing is that we made a first step in that direction and that we can now create and run tests (however slow it is). I can finally sleep without Kent hunting me in my dreams :-).<br><br><h2>Conclusion</h2><br><br>To be able to arrive to a solution in a reasonable time, we must be able to focus on our true (and minimalist) goal and take small and simple steps - even though our heart of programmer is bleeding at their lack of elegance and efficiency. Once we have a solution, we can iteratively improve it. In any case, imperfect something always beats a perfect nothing. (Well, unless we talk about Zen.)<br><br>Needless to say, I still suck both at maintaining the focus and doing the simple but inelegant.<br><br><p style="text-align:center;"><em>You might enjoy also other <a href="/tag/opinion/">posts on effective development</a>.</em></p>
++++
